#!/bin/bash

# ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç”¨ã®é–¢æ•°
timestamp() {
    date +"%Y-%m-%d %H:%M:%S.%N"
}

# å®Ÿè¡Œæ™‚é–“è¨ˆæ¸¬ç”¨ã®é–¢æ•°
measure_time() {
    local start_time=$1
    local end_time=$2
    echo "$(echo "$end_time - $start_time" | bc) seconds"
}

# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®é…åˆ—a
declare -a test_cases=(
    "Hello World"
    "Test Message"
    "1234567890"
    
    # æ—¥æœ¬èªãƒ†ã‚¹ãƒˆ
    "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ"
    "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™"
    "ã•ã‚ˆã†ãªã‚‰"
    "ãƒ†ã‚¹ãƒˆ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ã§ã™"
    "æ¼¢å­—ã¨ã²ã‚‰ãŒãªã¨ã‚«ã‚¿ã‚«ãƒŠã®æ··åœ¨æ–‡å­—åˆ—"
    
    # ãã®ä»–ã®ã‚¢ã‚¸ã‚¢è¨€èªãƒ†ã‚¹ãƒˆ
    "ì•ˆë…•í•˜ì„¸ìš”"  # éŸ“å›½èª
    "ä½ å¥½ä¸–ç•Œ"    # ä¸­å›½èªï¼ˆç°¡ä½“å­—ï¼‰
    "ã“ã‚“ã«ã¡ã¯ã€‚í•œê¸€ã€‚ä½ å¥½ã€‚"  # æ··åˆ
    
    # çµµæ–‡å­—ãƒ†ã‚¹ãƒˆ
    "ğŸ‘‹ Hello ğŸŒ"
    "ğŸ‰ ç¥ ğŸŠ"
    "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family"
    "ğŸ‡¯ğŸ‡µğŸ—¾ Japan"
    
    # ç‰¹æ®Šæ–‡å­—ãƒ†ã‚¹ãƒˆ
    "!@#$%^&*()_+"
    "~\`-=[]\\{}|;':\",./<>?"
    "Tab\tTest"
    "Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©Âª"
    
    # é•·æ–‡ãƒ†ã‚¹ãƒˆ
    "This is a very long message that contains multiple words and spaces to test the behavior with longer content"
    "ã“ã‚Œã¯éå¸¸ã«é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚è¤‡æ•°ã®æ–‡ç« ã‚’å«ã¿ã€é•·ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚æ”¹è¡Œã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚"
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
    "'; DROP TABLE users; --"
    "<script>alert('test')</script>"
    "{{7*7}}"
    "${PATH}"
    "$(ls -la)"
    
    # ç©ºç™½æ–‡å­—ãƒ†ã‚¹ãƒˆ
    "   "
    " ã€€"  # å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
    "\t\t\t"
    
    # æ”¹è¡Œãƒ†ã‚¹ãƒˆ
    "line1\nline2\nline3"
    "æ”¹è¡Œ1\næ”¹è¡Œ2\næ”¹è¡Œ3"
    
    # Unicodeæ–‡å­—ãƒ†ã‚¹ãƒˆ
    "âˆ‘âˆâˆªâˆ©âˆˆâˆ€âˆƒâˆ„âˆ…âˆ†âˆ‡âˆ‰âˆŠâˆ‹âˆŒâˆâˆâˆ"
    "Î±Î²Î³Î´ÎµÎ¶Î·Î¸Î¹ÎºÎ»Î¼Î½Î¾Î¿"
    "â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©"
    
    # çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆ
    "Hello ã“ã‚“ã«ã¡ã¯ 123 ğŸŒŸ âˆ‘"
    "Test@ãƒ†ã‚¹ãƒˆ#æµ‹è¯•#í…ŒìŠ¤íŠ¸"
    
    # åˆ¶å¾¡æ–‡å­—ãƒ†ã‚¹ãƒˆ
    "Hello\u0000World"
    "Test\u0007Message"
    
    # æ•°å€¤ãƒ†ã‚¹ãƒˆ
    "0"
    "-1"
    "3.14159"
    "1e-10"
    
    # æ¥µç«¯ãªã‚±ãƒ¼ã‚¹
    ""  # ç©ºæ–‡å­—åˆ—
    "a" # å˜ä¸€æ–‡å­—
    "ã‚" # å˜ä¸€æ—¥æœ¬èªæ–‡å­—
    "ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ" # å˜ä¸€çµµæ–‡å­—
    
    # å·¨å¤§ãªãƒ†ã‚­ã‚¹ãƒˆ
    "$(printf '@%.0s' {1..10000})"
	"ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ"
    "$(printf 'ã‚%.0s' {1..500})"
    
    # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ
    "<div>HTMLã‚¿ã‚°</div>"
    "{\"key\": \"JSONå½¢å¼\"}"
    "/*ã‚³ãƒ¡ãƒ³ãƒˆ*/"
    
    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ä½¿ã‚ã‚Œãã†ãªæ–‡å­—åˆ—
    "Password123!"
    "Admin@2024"
    
    # URLã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    "https://www.example.com"
    "user@example.com"
    
    # é›»è©±ç•ªå·å½¢å¼
    "+81-3-1234-5678"
    "090-1234-5678"
)

# å¼•æ•°ãƒã‚§ãƒƒã‚¯
if [ $# -ne 1 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <ãƒ—ãƒ­ã‚»ã‚¹ID>"
    exit 1
fi

pid=$1
total_tests=${#test_cases[@]}
passed=0
failed=0

echo "#### ãƒ†ã‚¹ãƒˆé–‹å§‹ ####"
echo "å®Ÿè¡Œæ™‚åˆ»: $(timestamp)"
echo "ç·ãƒ†ã‚¹ãƒˆæ•°: $total_tests"
echo

# å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œ
for test_case in "${test_cases[@]}"; do
    echo "ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: $test_case"
    start_time=$(cat /proc/uptime | awk '{print $1}')
    
    # ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡
    ./client $pid "$test_case"
    result=$?
    
    end_time=$(cat /proc/uptime | awk '{print $1}')
    execution_time=$(echo "$end_time - $start_time" | bc)
    
    if [ $result -eq 0 ]; then
        echo "âœ… æˆåŠŸ (å®Ÿè¡Œæ™‚é–“: $execution_time)"
        ((passed++))
    else
        echo "âŒ å¤±æ•— (å®Ÿè¡Œæ™‚é–“: $execution_time)"
        ((failed++))
    fi
    echo "-------------------"
	sleep 0.01
done

# ãƒ†ã‚¹ãƒˆçµæœã®ã‚µãƒãƒªãƒ¼
echo
echo "#### ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ ####"
echo "æˆåŠŸ: $passed"
echo "å¤±æ•—: $failed"
echo "æˆåŠŸç‡: $(echo "scale=2; $passed * 100 / $total_tests" | bc)%"
echo "å®Œäº†æ™‚åˆ»: $(timestamp)"